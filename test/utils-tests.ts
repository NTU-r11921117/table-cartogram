import {area, generatePolygon, fusePolygons} from '../src/utils';
import tape from 'tape';
import SavedBirdStrikes from './saved-bird-strikes.json';

tape('area', (t) => {
  const SQUARE = [
    {x: 10, y: 10},
    {x: 20, y: 10},
    {x: 20, y: 20},
    {x: 10, y: 20},
  ];
  t.equal(area(SQUARE), 100, 'should find the correct area for a square');

  const TRIANGLE = [
    {x: 10, y: 10},
    {x: 20, y: 10},
    {x: 20, y: 20},
  ];
  t.equal(area(TRIANGLE), 50, 'should find the correct area for a triangle');

  const POLYGON = generatePolygon(5, 10, {x: 10, y: 15});
  t.equal(area(POLYGON), 237.7641290737884, 'should find the correct area for a polygon');
  t.end();
});

tape('fusePolygons', (t) => {
  const results = fusePolygons(SavedBirdStrikes, (d) => d.data.name);
  const expectedResults = [
    {
      vertices: [
        {x: 0.22069152777643303, y: 0.07384897947723086},
        {x: 0.2089601071841638, y: 0.027034695775387203},
        {x: 0.18742933077935856, y: 0.13217174603531479},
        {x: 0.20475207028770973, y: 0.19502318026182358},
        {x: 0.21770495090460693, y: 0.23911370833694068},
        {x: 0.14084096957945416, y: 0.3},
        {x: 0, y: 0.3},
        {x: 0, y: 0},
        {x: 0.27735094126015575, y: 0},
      ],
      key: 'Midwest',
    },
    {
      vertices: [
        {x: 0.6149107177284888, y: 0.21981997812709772},
        {x: 0.580545301695947, y: 0.16546780446830217},
        {x: 0.6105954017579522, y: 0.09726417525665841},
        {x: 0.5791045681599444, y: 0.0436604285195686},
        {x: 0.5689087495205509, y: 0},
        {x: 0.27735094126015575, y: 0},
        {x: 0.22069152777643303, y: 0.07384897947723086},
        {x: 0.25847661265936483, y: 0.1169815046936408},
        {x: 0.18742933077935856, y: 0.13217174603531479},
        {x: 0.20475207028770973, y: 0.19502318026182358},
        {x: 0.21770495090460693, y: 0.23911370833694068},
        {x: 0.14084096957945416, y: 0.3},
        {x: 0.5419205447339661, y: 0.3},
      ],
      key: 'South',
    },
    {
      vertices: [
        {x: 0.8841217298039928, y: 0},
        {x: 0.5689087495205509, y: 0},
        {x: 0.5791045681599444, y: 0.0436604285195686},
        {x: 0.6105954017579522, y: 0.09726417525665841},
        {x: 0.580545301695947, y: 0.16546780446830217},
        {x: 0.6149107177284888, y: 0.21981997812709772},
        {x: 0.5419205447339661, y: 0.3},
        {x: 0.7405234764147632, y: 0.3},
        {x: 0.7917170685482705, y: 0.2560530434164313},
        {x: 0.780719453263419, y: 0.17044456136426042},
        {x: 0.8006878406527494, y: 0.09123489461020409},
        {x: 0.8582487193618223, y: 0.12512749493592018},
        {x: 0.8160673650588451, y: 0.07078434761770484},
      ],
      key: 'West',
    },
    {
      vertices: [
        {x: 1, y: 0.21731063089827807},
        {x: 1, y: 0},
        {x: 0.8841217298039928, y: 0},
        {x: 0.8160673650588451, y: 0.07078434761770484},
        {x: 0.8582487193618223, y: 0.12512749493592018},
        {x: 0.8006878406527494, y: 0.09123489461020409},
        {x: 0.780719453263419, y: 0.17044456136426042},
        {x: 0.7917170685482705, y: 0.2560530434164313},
        {x: 0.7405234764147632, y: 0.3},
        {x: 0.9320327659099618, y: 0.3},
        {x: 0.8929245664331396, y: 0.17062989884011562},
      ],
      key: 'Northeast',
    },
    {
      vertices: [
        {x: 0.18742933077935856, y: 0.13217174603531479},
        {x: 0.2089601071841638, y: 0.027034695775387203},
        {x: 0.22069152777643303, y: 0.07384897947723086},
        {x: 0.25847661265936483, y: 0.1169815046936408},
      ],
      key: 'Canada',
    },
    {
      vertices: [
        {x: 1, y: 0.3},
        {x: 1, y: 0.21731063089827807},
        {x: 0.8929245664331396, y: 0.17062989884011562},
        {x: 0.9320327659099618, y: 0.3},
      ],
      key: 'US Islands',
    },
  ];
  t.deepEqual(expectedResults, results, 'should find the bird polygons fused correctly');
  t.end();
});
